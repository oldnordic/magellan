---
phase: 13-scip-tests-docs
plan: 03
type: execute
wave: 3
depends_on: []
files_modified:
  - README.md
autonomous: true
must_haves:
  truths:
    - "Users are warned about placing .db files in watched directories"
    - "Documentation shows recommended database placement (outside watched dir)"
    - "Examples demonstrate both recommended and discouraged patterns"
    - "Security rationale is explained (prevent processing .db as source file)"
  artifacts:
    - path: "README.md"
      provides: "User-facing security guidance"
      contains: "Security", "database", "watched directory"
      min_lines: 400  # after adding Security section
  key_links:
    - from: "README.md"
      to: "src/validation.rs"
      via: "reference to path validation security implementation"
      pattern: "validate_path_within_root|path.*validation"
---

<objective>
Document database file placement recommendations to prevent security issues.

Purpose: Placing the .db file inside a watched directory can cause the watcher to process it as a source file, potentially including binary database content in exports or causing circular events. Users need clear guidance on recommended database placement.

Output: README.md updated with Security section explaining .db placement best practices with examples.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/13-scip-tests-docs/13-RESEARCH.md
@README.md
@src/validation.rs
</context>

<tasks>

<task type="auto">
  <name>Add Security section to README.md</name>
  <files>README.md</files>
  <action>
    Add a new "Security" section after the "Commands" section in README.md.

    Section should include:

    1. Heading: ## Security

    2. Database Placement subsection with:
       - Why .db placement matters
       - What happens if .db is in watched directory
       - Recommended placement pattern
       - Code examples showing good vs bad patterns

    3. Example content structure:
       ```markdown
       ## Security

       ### Database File Placement

       Magellan's database (`--db <FILE>`) stores all indexed code information.

       **Recommended:** Place `.db` files outside watched directories.

       Placing the database inside a watched directory can cause:
       - The watcher to process the database as if it's a source file
       - Export operations to include binary database content
       - Circular file system events

       **Examples:**

       ```bash
       # Recommended: database outside watched directory
       magellan watch --root /path/to/project --db ~/.cache/magellan/project.db --scan-initial

       # Discouraged: database inside watched directory
       magellan watch --root . --db ./magellan.db --scan-initial
       ```

       ### Recommended Database Locations

       - Linux/macOS: `~/.cache/magellan/` or `~/.local/share/magellan/`
       - Windows: `%LOCALAPPDATA%\magellan\`
       - CI/CD: Use a cache directory outside the workspace
       ```

    Place the Security section after "Commands" (around line 300) and before "Supported Languages".
  </action>
  <verify>grep -q "## Security" /home/feanor/Projects/magellan/README.md</verify>
  <done>README.md contains Security section with database placement guidance</done>
</task>

<task type="auto">
  <name>Update Quick Start examples with safe .db placement</name>
  <files>README.md</files>
  <action>
    Review and update the Quick Start section examples to use recommended database placement:

    1. Find current examples using `--db ./magellan.db` or similar

    2. Update to use recommended patterns:
       - For simple examples: keep `./magellan.db` for simplicity but add a note
       - For production examples: use `~/.cache/magellan/project.db`

    3. Add a brief note after Quick Start:
       ```markdown
       > **Note:** For production use, place databases outside watched directories.
       > See [Security](#security) for details.
       ```

    Don't break existing workflows - the examples should still work for users.
    The note guides users to the Security section for best practices.
  </action>
  <verify>grep -A5 "Quick Start" /home/feanor/Projects/magellan/README.md | head -10</verify>
  <done>Quick Start examples reference Security section for database placement</done>
</task>

<task type="auto">
  <name>Add path traversal protection note</name>
  <files>README.md</files>
  <action>
    Add a subsection to Security explaining Magellan's built-in path protections:

    ```markdown
    ### Path Traversal Protection

    Magellan validates all file paths to prevent directory traversal attacks:
    - Paths with `../` patterns are validated before access
    - Symlinks pointing outside the project root are rejected
    - Absolute paths outside the watched directory are blocked

    These protections are implemented in `src/validation.rs` and applied during:
    - Watcher event processing
    - Directory scanning
    - File indexing operations

    See Phase 10 of the development roadmap for implementation details.
    ```

    Place this subsection after Database Placement, before any other security content.
  </action>
  <verify>grep -q "Path Traversal Protection" /home/feanor/Projects/magellan/README.md</verify>
  <done>Security section documents path traversal protections</done>
</task>

</tasks>

<verification>
1. README.md contains new Security section
2. Security section has Database Placement subsection
3. Security section has Path Traversal Protection subsection
4. Quick Start references Security guidance
5. Code examples show both good and bad patterns
</verification>

<success_criteria>
- Security section exists in README.md
- Database placement guidance is clear with examples
- Path traversal protections are documented
- Users can understand both what to do and why
</success_criteria>

<output>
After completion, create `.planning/phases/13-scip-tests-docs/13-03-SUMMARY.md`
</output>
