---
phase: 06-query-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/find_cmd.rs
autonomous: true

must_haves:
  truths:
    - "User can look up symbol definitions by name and receive stable symbol_id"
    - "Find by name returns same format as glob listing (consistent symbol_id field)"
    - "JSON output includes symbol_id for exact name searches"
  artifacts:
    - path: "src/find_cmd.rs"
      provides: "Symbol lookup with stable IDs"
      min_lines: 280
  key_links:
    - from: "src/find_cmd.rs:output_json_mode"
      to: "symbol_nodes_in_file_with_ids"
      via: "Pass s.symbol_id to SymbolMatch::new"
      pattern: "SymbolMatch::new\\(.*s\\.symbol_id\\)"
---

<objective>
Fix find command to propagate symbol_id in JSON output for exact name searches.

Purpose: The find command's glob listing (line 362) correctly includes symbol_id, but the exact name search (line 289) sets symbol_id to None. This inconsistency means users get stable IDs from glob queries but not from exact name searches. The fix aligns both code paths.

Output: Consistent symbol_id propagation in all find command JSON outputs.

Context: Phase 5 added symbol_id to SymbolNode and SymbolMatch. The query command uses symbol_nodes_in_file_with_ids() correctly. Find command's glob path uses it correctly. Only the exact name path is broken.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-query-ux/06-RESEARCH.md
@src/find_cmd.rs
@src/output/command.rs
@src/graph/query.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix symbol_id propagation in find_json_mode</name>
  <files>src/find_cmd.rs</files>
  <action>
    Change line 289 in src/find_cmd.rs from:
    ```rust
    SymbolMatch::new(s.name, s.kind_normalized, span, None, None)
    ```
    To:
    ```rust
    SymbolMatch::new(s.name, s.kind_normalized, span, None, s.symbol_id)
    ```

    The FoundSymbol struct (lines 13-28) already includes symbol_id: Option<String>.
    The find_in_file and find_all_files functions already populate symbol_id from symbol_nodes_in_file_with_ids.
    Only the JSON output constructor was missing the propagation.

    DO NOT modify the glob listing path (line 362) - it is already correct.
  </action>
  <verify>
    cargo test --package magellan test_find_symbol_by_name
    cargo test find
  </verify>
  <done>
    Exact name search returns symbol_id in JSON output, matching glob listing behavior.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add test for symbol_id in find JSON output</name>
  <files>tests/cli_query_tests.rs</files>
  <action>
    Add a test to verify that find --name returns symbol_id in JSON output.

    Test pattern:
    1. Create test file with a function
    2. Index the file
    3. Run find --name with --output json
    4. Parse JSON and verify symbol_id field exists and is a non-empty string

    Follow existing test pattern from test_files_lists_all().
    Place test after existing find tests around line 700.

    Test name: test_find_includes_symbol_id_in_json
  </action>
  <verify>
    cargo test test_find_includes_symbol_id_in_json
  </verify>
  <done>
    Test confirms symbol_id is present in find JSON output.
  </done>
</task>

</tasks>

<verification>
1. Run existing find tests: cargo test find
2. Run new test: cargo test test_find_includes_symbol_id_in_json
3. Manual verification: magellan find --db test.db --name main --output json | jq '.data.matches[0].symbol_id'
</verification>

<success_criteria>
1. find --name returns JSON with symbol_id field populated
2. find --list-glob and find --name return consistent JSON structure
3. All existing tests pass
4. New test validates symbol_id presence
</success_criteria>

<output>
After completion, create `.planning/phases/06-query-ux/06-01-SUMMARY.md`
</output>
