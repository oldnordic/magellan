---
phase: 01-persistence-compatibility-baseline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Cargo.toml
  - Cargo.lock
autonomous: true
must_haves:
  truths:
    - "Building Magellan uses sqlitegraph v1.0.0 from crates.io (pinned, no drift)."
  artifacts:
    - path: "Cargo.toml"
      provides: "sqlitegraph dependency pinned to crates.io v1.0.0"
      contains: "sqlitegraph = \"1.0.0\""
  key_links:
    - from: "Cargo.toml"
      to: "https://crates.io/crates/sqlitegraph"
      via: "version pin"
      pattern: "sqlitegraph = \"1.0.0\""
---

<objective>
Upgrade Magellan to sqlitegraph v1.0.0 from crates.io (DB-01).

Purpose: Pin Magellanâ€™s persistence layer to the latest published sqlitegraph so compatibility rules are enforced against a known, reproducible schema version.
Output: Cargo dependency wiring + lockfile updated to sqlitegraph v1.0.0 from crates.io.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-persistence-compatibility-baseline/01-RESEARCH.md
@Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade sqlitegraph dependency to v1.0.0</name>
  <files>Cargo.toml</files>
  <action>
- Upgrade Magellan's sqlitegraph dependency to the latest published major: `sqlitegraph = "1.0.0"`.
- Keep the existing feature mapping intact:
  - `native-v2 = ["sqlitegraph/native-v2"]`
- Remove/replace the existing `sqlitegraph = "0.2.11"` entry.
- Do NOT add new features or change other dependencies in this phase.

Optional (developer convenience only, not required for Phase 1 correctness):
- If you still want to develop against a local checkout, use:
  ```toml
  [patch.crates-io]
  sqlitegraph = { path = "../sqlitegraph/sqlitegraph" }
  ```
  But keep the primary dependency as `sqlitegraph = "1.0.0"`.
  </action>
  <verify>
- `cargo build`
- `cargo tree -i sqlitegraph` shows sqlitegraph v1.0.0 (registry) (or registry + local patch if you opted in during development).
  </verify>
  <done>
- `Cargo.toml` depends on sqlitegraph v1.0.0 from crates.io.
- `cargo build` succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refresh lockfile and run full test suite</name>
  <files>Cargo.lock</files>
  <action>
- Regenerate/refresh `Cargo.lock` so it resolves sqlitegraph from the local checkout.
- Run the full Rust test suite to ensure no breakage from the sqlitegraph upgrade.
  </action>
  <verify>
- `cargo test --workspace`
- `cargo test --workspace --features native-v2` (ensures feature wiring still compiles)
  </verify>
  <done>
- All tests pass with sqlitegraph v1.0.0.
  </done>
</task>

</tasks>

<verification>
- Confirm `cargo tree -i sqlitegraph` references local path checkout.
- Confirm build and tests pass under default features and `native-v2` feature.
</verification>

<success_criteria>
- Magellan can be built and tested while using the local sqlitegraph checkout (DB-01 satisfied).
</success_criteria>

<output>
After completion, create `.planning/phases/01-persistence-compatibility-baseline/01-01-SUMMARY.md`.
</output>
