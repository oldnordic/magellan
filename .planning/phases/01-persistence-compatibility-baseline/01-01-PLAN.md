---
phase: 01-persistence-compatibility-baseline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Cargo.toml
  - Cargo.lock
autonomous: true
must_haves:
  truths:
    - "Building Magellan uses the local sqlitegraph checkout (no crates.io drift)."
  artifacts:
    - path: "Cargo.toml"
      provides: "sqlitegraph dependency pinned to local path"
      contains: "sqlitegraph = { version = \"1.0.0\", path = \"../sqlitegraph/sqlitegraph\" }"
  key_links:
    - from: "Cargo.toml"
      to: "/home/feanor/Projects/sqlitegraph/sqlitegraph"
      via: "path dependency"
      pattern: "path = \"../sqlitegraph/sqlitegraph\""
---

<objective>
Switch Magellan to build against the local sqlitegraph checkout (DB-01).

Purpose: Eliminate hidden dependency drift so DB compatibility rules can be enforced against a known sqlitegraph schema version.
Output: Cargo dependency wiring + lockfile updated to sqlitegraph v1.0.0 from local path.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-persistence-compatibility-baseline/01-RESEARCH.md
@Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire sqlitegraph as a local path dependency</name>
  <files>Cargo.toml</files>
  <action>
- Update Magellan's sqlitegraph dependency to use the local checkout at `/home/feanor/Projects/sqlitegraph/sqlitegraph`.
- Prefer the "version + path" form from research to keep the semver pin while forcing the local source:
  - `sqlitegraph = { version = "1.0.0", path = "../sqlitegraph/sqlitegraph" }`
- Keep the existing feature mapping intact:
  - `native-v2 = ["sqlitegraph/native-v2"]`
- Remove/replace the existing `sqlitegraph = "0.2.11"` entry.
- Do NOT add new features or change other dependencies in this phase.
  </action>
  <verify>
- `cargo build`
- `cargo tree -i sqlitegraph` shows sqlitegraph v1.0.0 and indicates it is sourced from the local path (not registry).
  </verify>
  <done>
- `Cargo.toml` depends on sqlitegraph v1.0.0 via `path = "../sqlitegraph/sqlitegraph"`.
- `cargo build` succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refresh lockfile and run full test suite</name>
  <files>Cargo.lock</files>
  <action>
- Regenerate/refresh `Cargo.lock` so it resolves sqlitegraph from the local checkout.
- Run the full Rust test suite to ensure no breakage from the sqlitegraph upgrade.
  </action>
  <verify>
- `cargo test --workspace`
- `cargo test --workspace --features native-v2` (ensures feature wiring still compiles)
  </verify>
  <done>
- All tests pass with sqlitegraph coming from the local checkout.
  </done>
</task>

</tasks>

<verification>
- Confirm `cargo tree -i sqlitegraph` references local path checkout.
- Confirm build and tests pass under default features and `native-v2` feature.
</verification>

<success_criteria>
- Magellan can be built and tested while using the local sqlitegraph checkout (DB-01 satisfied).
</success_criteria>

<output>
After completion, create `.planning/phases/01-persistence-compatibility-baseline/01-01-SUMMARY.md`.
</output>
