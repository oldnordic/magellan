---
phase: 08-validation-hooks
plan: 02
type: execute
wave: 2
depends_on: [08-01]
files_modified:
  - src/output/command.rs
  - src/output/mod.rs
autonomous: true
must_haves:
  truths:
    - "ValidationResponse type exists for JSON output"
    - "ValidationResponse is serializable and follows JsonResponse pattern"
    - "ValidationResponse includes passed, error_count, errors, warning_count, warnings"
    - "ValidationError and ValidationWarning types are exported from output module"
  artifacts:
    - path: "src/output/command.rs"
      provides: "ValidationResponse type for JSON validation output"
      min_lines: 50
    - path: "src/output/mod.rs"
      provides: "Public exports for validation types"
      exports: ["ValidationResponse", "ValidationError", "ValidationWarning"]
  key_links:
    - from: "ValidationResponse"
      to: "JsonResponse<T>"
      via: "Wrapped by JsonResponse for schema_version and execution_id"
      pattern: "JsonResponse::new"
    - from: "ValidationResponse"
      to: "src/graph/validation.rs"
      via: "Conversion from ValidationReport to ValidationResponse"
      pattern: "ValidationReport"
---

<objective>
Create JSON output types for validation results.

Purpose: Enable structured JSON output for validation results following the existing JsonResponse contract.
Output: ValidationResponse type that wraps validation results for CLI output.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/08-validation-hooks/08-CONTEXT.md
@.planning/phases/08-validation-hooks/08-RESEARCH.md

@src/output/command.rs
@src/graph/validation.rs
@.planning/phases/08-validation-hooks/08-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ValidationResponse type to output/command.rs</name>
  <files>src/output/command.rs</files>
  <action>
    Add validation response types to src/output/command.rs:

    1. ValidationResponse struct (after StatusResponse, before ErrorResponse):
       ```rust
       #[derive(Debug, Clone, Serialize, Deserialize)]
       pub struct ValidationResponse {
           /// Whether validation passed
           pub passed: bool,
           /// Number of errors found
           pub error_count: usize,
           /// Detailed error information
           pub errors: Vec<ValidationError>,
           /// Number of warnings found
           pub warning_count: usize,
           /// Detailed warning information
           pub warnings: Vec<ValidationWarning>,
       }
       ```

    2. ValidationError struct (reuse from validation module design):
       - pub code: String
       - pub message: String
       - pub entity_id: Option<String>
       - pub details: serde_json::Value

    3. ValidationWarning struct (same structure as ValidationError)

    IMPORTANT: These types duplicate the validation module types for JSON output
    because the module types are internal to graph and output types are public API.

    Follow the exact pattern of existing response types (StatusResponse lines 739-752).
  </action>
  <verify>
    cargo check --lib 2>&1 | grep -E "(error|warning)" || echo "Type definitions compile"
  </verify>
  <done>
    ValidationResponse, ValidationError, ValidationWarning types exist in output/command.rs.
    All types derive Serialize, Deserialize.
    Types are placed in correct order (after StatusResponse, before ErrorResponse).
  </done>
</task>

<task type="auto">
  <name>Task 2: Export validation types from output/mod.rs</name>
  <files>src/output/mod.rs</files>
  <action>
    Update src/output/mod.rs to export validation types:

    Add ValidationResponse, ValidationError, ValidationWarning to the pub use statement:

    ```rust
pub use command::{
    generate_execution_id, output_json, ErrorResponse, FilesResponse,
    FindResponse, JsonResponse, OutputFormat, QueryResponse, RefsResponse, ReferenceMatch, Span,
    StatusResponse, SymbolMatch,
    ValidationResponse, ValidationError, ValidationWarning,  // NEW
};
    ```

    Follow the existing export pattern (line 7-11).
  </action>
  <verify>
    cargo check --lib 2>&1
  </verify>
  <done>
    ValidationResponse, ValidationError, ValidationWarning are exported from output module.
    Types are accessible via magellan::output::ValidationResponse.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add From impl for ValidationReport to ValidationResponse conversion</name>
  <files>src/output/command.rs</files>
  <action>
    Add From implementation for converting graph::ValidationReport to output::ValidationResponse.

    This will be used by CLI handlers to convert internal validation results to JSON output.

    Add in src/output/command.rs after ValidationResponse definition:
    ```rust
    // Conversion from internal validation report to public response type
    impl From<crate::graph::validation::ValidationReport> for ValidationResponse {
        fn from(report: crate::graph::validation::ValidationReport) -> Self {
            ValidationResponse {
                passed: report.passed,
                error_count: report.errors.len(),
                errors: report.errors.into_iter().map(|e| ValidationError {
                    code: e.code,
                    message: e.message,
                    entity_id: e.entity_id,
                    details: e.details,
                }).collect(),
                warning_count: report.warnings.len(),
                warnings: report.warnings.into_iter().map(|w| ValidationWarning {
                    code: w.code,
                    message: w.message,
                    entity_id: w.entity_id,
                    details: w.details,
                }).collect(),
            }
        }
    }
    ```

    Note: This requires the validation module types to have public fields (which they do from 08-01).
  </action>
  <verify>
    cargo check --lib 2>&1
  </verify>
  <done>
    From<ValidationReport> for ValidationResponse is implemented.
    Conversion maps all fields from internal to public types.
    Function compiles without errors.
  </done>
</task>

</tasks>

<verification>
1. cargo check --lib passes with no errors
2. ValidationResponse is accessible from magellan::output
3. From<ValidationReport> conversion compiles
4. All validation types are in the public API
</verification>

<success_criteria>
- ValidationResponse type exists in output/command.rs
- ValidationResponse, ValidationError, ValidationWarning exported from output module
- From implementation for ValidationReport -> ValidationResponse exists
- All types serialize correctly to JSON
</success_criteria>

<output>
After completion, create `.planning/phases/08-validation-hooks/08-02-SUMMARY.md`
</output>
