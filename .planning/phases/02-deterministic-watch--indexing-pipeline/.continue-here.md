---
phase: 02-deterministic-watch--indexing-pipeline
task: 0
total_tasks: 3
status: context_complete
last_updated: 2026-01-19T08:45Z
---

<current_state>

Phase 2 context gathering is COMPLETE. Ready to move to `/gsd:plan-phase 2`.

The phase 2 CONTEXT.md has been created with implementation decisions for:
- Debounce strategy (batch processing, configurable window, deterministic sort, backpressure)
- Delete propagation (soft delete with deleted files list, time-based expiry)
- Error handling (configurable output format, persisted errors, error limit threshold)
- Ignore/include/exclude (gitignore syntax, hybrid config, last-wins precedence)

There are UNCOMMITTED changes in src/graph/*.rs and src/lib.rs - these appear to be in-progress work from an earlier session. Should be reviewed before proceeding.

</current_state>

<completed_work>

- ✓ Phase 1 (Persistence Compatibility Baseline) - COMPLETE
  - All 4 plans executed
  - sqlitegraph v1.0.0 pinned
  - DB compatibility checks implemented
  - magellan_meta table added
- ✓ Codebase mapping completed - .planning/codebase/ with 7 documents
- ✓ Phase 2 CONTEXT.md created with implementation decisions

</completed_work>

<remaining_work>

Phase 2 has 3 plans to execute:
- 02-01-PLAN.md — Per-file reconcile + delete_file_facts (true idempotency)
- 02-02-PLAN.md — Debounced batching + buffer events during scan-initial
- 02-03-PLAN.md — Include/exclude rules + structured diagnostics

Next action: Run `/gsd:plan-phase 2` to begin planning the first sub-plan.

</remaining_work>

<decisions_made>

From Phase 2 context discussion:
- Batch processing with configurable `--debounce-ms` flag
- Deterministic sort by path within batch for reproducibility
- Backpressure handling for massive event storms (stop, notify, resume)
- Soft delete via separate deleted files list (not tombstones)
- Time-based expiry for deleted file records
- Configurable error output format (JSON/plain)
- Errors persisted to DB for later query
- Error limit threshold to prevent runaway failures
- Gitignore-style patterns for ignore/include/exclude
- Hybrid: `.magellanignore` + CLI flags
- Last-wins precedence for conflicting patterns

</decisions_made>

<blockers>

None. However, there are uncommitted changes in src/ that should be reviewed:
- src/graph/call_ops.rs
- src/graph/count.rs
- src/graph/mod.rs
- src/graph/ops.rs
- src/graph/query.rs
- src/graph/references.rs
- src/graph/schema.rs
- src/lib.rs

These may be from previous work or diagnostics. Should commit or stash before starting Phase 2 execution.

</blockers>

<context>

User completed Phase 1 and just finished the context gathering discussion for Phase 2. The CONTEXT.md is comprehensive with clear implementation decisions that will guide the planner.

The "Claude's Discretion" section leaves room for defaults (debounce duration, error limit, TTL, error schema, backpressure UX) which the planner can specify.

Phase 2 is about making watch mode deterministic and reliable - the foundation for everything that follows. Once watch mode is solid, we can build JSON output contracts, span models, stable IDs, and query UX on top.

</context>

<next_action>

1. Review uncommitted changes in src/ (commit or stash)
2. Run `/gsd:plan-phase 2` to begin creating the 3 plans for Phase 2

</next_action>
