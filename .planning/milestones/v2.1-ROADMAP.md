# v2.1 Backend Parity Completion â€” Archived Roadmap

**Archived:** 2026-02-08
**Milestone:** v2.1 Backend Parity Completion
**Status:** SHIPPED
**Tag:** v2.1.0

---

## Milestone Goal

Ensure all CLI query commands and ChunkStore methods work with both SQLite and Native-V2 backends using TDD methodology.

**Approach:** Test-Driven Development - each phase follows TDD: write failing test on Native-V2, fix code, verify both backends.

**Status:** Complete - All 4 phases (56-59) finished with comprehensive test coverage.

---

## Phase 56: get_chunks_for_file() KV Support

**Goal:** ChunkStore.get_chunks_for_file() works correctly on Native-V2 backend using KV store queries.

**Status:** Complete - 2026-02-08

**Depends on:** Phase 55

**Requirements:** CHUNK-01

**Success Criteria** (what must be TRUE):
1. User can run `magellan chunks --db <native-v2-db>` and get correct output
2. User can retrieve all code chunks for a specific file on Native-V2 backend
3. Cross-backend test verifies identical results for SQLite vs Native-V2

**Plans:** 2/3 complete (56-02 skipped as redundant)

**Implementation:**
- KV prefix scan using `chunk:{escaped_path}:` pattern
- Colon escaping with `::` for file paths containing colons
- Sort by `byte_start` for consistent ordering
- Early return pattern with SQLite fallback

**Commits:**
- e961e1d: test(56-01): add failing test
- 7b25126: feat(56-01): add KV prefix scan support
- b79e738: refactor(56-01): remove unused mut
- 05c65e6: docs(56-01): complete plan
- fdb1c0b: docs(56-03): update NATIVE-V2.md

---

## Phase 57: get_chunk_by_span() Verification

**Goal:** ChunkStore.get_chunk_by_span() verified to work correctly on both backends.

**Status:** Complete - 2026-02-08

**Depends on:** Phase 56

**Requirements:** CHUNK-03

**Success Criteria** (what must be TRUE):
1. User can retrieve a code chunk by exact byte span on Native-V2 backend
2. Cross-backend test verifies identical results for SQLite vs Native-V2
3. Edge cases (missing chunks, overlapping spans) handled correctly

**Plans:** 2/2 complete

**Note:** `get_chunk_by_span()` already has KV support (lines 461-485 in src/generation/mod.rs). This phase verified correctness with comprehensive tests.

**Commits:**
- f13aa14: test(57-01): add cross-backend tests for get_chunk_by_span()
- 4f7cc42: docs(57-01): complete get_chunk_by_span() verification plan
- 3e4daf3: test(57-02): add edge case tests for get_chunk_by_span()
- d5ad3ac: docs(57-02): document ChunkStore KV support and get_chunk_by_span()
- d470667: docs(57-02): complete edge case testing and documentation plan

---

## Phase 58: CLI Command Parity - Chunk Queries

**Goal:** `magellan chunks`, `magellan get`, and `magellan get-file` commands work identically on both backends.

**Status:** Complete - 2026-02-08

**Depends on:** Phase 56, Phase 57

**Requirements:** QUERY-01, QUERY-02, QUERY-03

**Success Criteria** (what must be TRUE):
1. User can run `magellan chunks` on Native-V2 and see all code chunks
2. User can run `magellan get --file <path> --span <start>:<end>` on Native-V2
3. User can run `magellan get-file <path>` on Native-V2
4. All three commands produce identical JSON output on SQLite vs Native-V2

**Plans:** 3/3 complete

**Commits:**
- 8d19e83: test(58-01): add CLI integration tests for magellan chunks command
- 2fe7a7e: test(58-02): add CLI integration tests for magellan get command
- a5fb532: docs(58-02): complete CLI integration tests plan for magellan get command

---

## Phase 59: CLI Command Parity - AST Queries + Test Suite

**Goal:** `magellan ast`, `magellan find-ast` commands work identically on both backends; comprehensive cross-backend test suite exists.

**Status:** Complete - 2026-02-08

**Depends on:** Phase 58

**Requirements:** QUERY-04, QUERY-05, VERIFY-01

**Success Criteria** (what must be TRUE):
1. User can run `magellan ast --file <path>` on Native-V2 and see AST nodes
2. User can run `magellan find-ast --kind <kind>` on Native-V2 and get filtered results
3. Cross-backend test suite exercises all query commands with representative data
4. Test suite can be run with `--features native-v2` flag

**Plans:** 4/4 complete

**Commits:**
- b1d5b94: test(59-01): add CLI integration tests for magellan ast command
- d9a2c5f: docs(59-02): complete find-ast CLI integration tests plan
- 0b3bead: feat(59-03): add comprehensive AST query tests and fix file:path KV storage
- c4b4faa: feat(59-03): add unified cross-backend parity test for all query commands
- db02a64: docs(59-04): add AST Query Operations section to NATIVE-V2.md
- 9d2382b: docs(59-04): add v2.1 Backend Parity Completion section to README.md
- 5d75f30: docs(59-04): update CHANGELOG.md with v2.1.0 completion details
- fe31ebe: docs(59-04): mark Phase 59 and v2.1 milestone complete in ROADMAP.md
- 425b297: docs(59-04): create SUMMARY.md for Phase 59 Plan 04
- aac90a2: docs(59-04): update STATE.md with Phase 59 Plan 04 completion

---

## Summary

**Total Phases:** 4
**Total Plans:** 13
**Git Range:** 9065bef..aac90a2 (26 commits)
**Duration:** 2026-02-08

**Requirements Coverage:** 8/8 (100%)
- QUERY-01: magellan chunks command
- QUERY-02: magellan get command
- QUERY-03: magellan get-file command
- QUERY-04: magellan ast command
- QUERY-05: magellan find-ast command
- CHUNK-01: get_chunks_for_file() KV support
- CHUNK-03: get_chunk_by_span() KV support
- VERIFY-01: Cross-backend test suite

**Test Results:**
- Backend integration tests: 14/14 pass
- CLI command tests: 18/18 pass

---

*Archived from ROADMAP.md - 2026-02-08*
